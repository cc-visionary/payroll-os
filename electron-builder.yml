# =============================================================================
# PeopleOS PH - Electron Builder Configuration
# =============================================================================
# Electron code goes inside app.asar (files).
# Next.js server payload goes to extraResources (real filesystem) because
# the spawned child node.exe cannot read from inside asar archives.
# =============================================================================

appId: com.peopleos.payroll
productName: PeopleOS Payroll
copyright: Copyright © 2026 PeopleOS

directories:
  output: dist
  buildResources: resources

# ─── Files included in app.asar ──────────────────────────────────────────────
# ONLY Electron main-process code and its direct dependencies.
files:
  - dist-electron/**/*
  - package.json
  # electron-updater and all its dependencies (required by main process for auto-updates)
  - node_modules/electron-updater/**/*
  - node_modules/builder-util-runtime/**/*
  - node_modules/argparse/**/*
  - node_modules/debug/**/*
  - node_modules/fs-extra/**/*
  - node_modules/graceful-fs/**/*
  - node_modules/js-yaml/**/*
  - node_modules/jsonfile/**/*
  - node_modules/lazy-val/**/*
  - node_modules/lodash.escaperegexp/**/*
  - node_modules/lodash.isequal/**/*
  - node_modules/ms/**/*
  - node_modules/sax/**/*
  - node_modules/semver/**/*
  - node_modules/tiny-typed-emitter/**/*
  - node_modules/universalify/**/*
  # Exclude unnecessary files from asar
  - "!**/node_modules/.cache/**"
  - "!**/*.map"

# ─── Extra resources (outside asar, on real filesystem) ──────────────────────
extraResources:
  # Next.js standalone payload
  - from: resources/payload
    to: payload
    filter:
      - "**/*"
  # WORKAROUND: Explicitly copy node_modules — electron-builder
  # strips node_modules by default even from extraResources
  - from: resources/payload/node_modules
    to: payload/node_modules
    filter:
      - "**/*"
  # Node.js runtime (downloaded during CI)
  - from: node-runtime
    to: node-runtime
    filter:
      - "**/*"

asar: true

# =============================================================================
# Windows Configuration
# =============================================================================
win:
  target:
    - target: nsis
      arch:
        - x64
  icon: resources/icons/people.png
  artifactName: ${productName}-Setup-${version}.${ext}

nsis:
  oneClick: false
  allowToChangeInstallationDirectory: true
  createDesktopShortcut: true
  createStartMenuShortcut: true
  shortcutName: PeopleOS Payroll

# =============================================================================
# Auto-updater Configuration (GitHub Releases)
# =============================================================================
publish:
  provider: github
  owner: cc-visionary
  repo: payroll-os
  releaseType: release
